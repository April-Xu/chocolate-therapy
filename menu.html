<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chocolate Therapy</title>
    <style>* {padding: 0; margin: 0}</style>
    <script src="js/pixi.min.js"></script>
    <script src="js/pixi-sound.js"></script>
</head>
<body>
<script type="text/javascript">
    //get visibility
    var href = location.href;
    eval("var " + href.substring(href.indexOf("?") + 1) + ";");
    var visibility = a;
    //var visibility = 7; //this is for layout test

    //Get webgl support
    let type = "WebGL";
    if(!PIXI.utils.isWebGLSupported()){
        type = "canvas";
    }
    PIXI.utils.sayHello(type);

    //Create a Pixi Application
    let app = new PIXI.Application({width: 800, height: 450});
    //Add the canvas that Pixi automatically created for you to the HTML document
    //Color palette: brown"#6b432d", darken brown"#673729"
    app.renderer.view.style.position = "absolute";
    app.renderer.view.style.display = "block";
    app.renderer.autoResize = true;
    app.renderer.resize(window.innerWidth, window.innerHeight);
    document.body.appendChild(app.view);
    //add sound track
    const bg = new PIXI.sound.Sound.from("assets/sounds/bg.mp3");
    bg.play();

    PIXI.loader.add([
        "assets/images/normal chocolate.png",
        "assets/images/final chocolate.png"
    ]).load(setup);

    function setup(){
        //Add chocolate box
        var levelName=["Joy", "Sadness", "Nervous", "Shy",
            "Anger", "Anticipation"];
        //draw first 6 level
        for (var i=0; i<6;i++) {
            let normalLevel = new
            PIXI.Sprite(PIXI.loader.resources["assets/images/normal chocolate.png"].texture);
            normalLevel.anchor.set(0.5, 0.5);
            normalLevel.position.set(app.renderer.view.width/4+i%3*app.renderer.view.width/5,
                app.renderer.view.height/4*(2*Math.floor(i/3)+1));
            normalLevel.scale.set(0.2, 0.2);
            let level = new PIXI.Text(levelName[i]);
            level.style = {
                fontFamily: "Arial",
                fontSize: 36,
                fill: "white",
            };
            level.anchor.set(0.5, 0.5);
            level.position.set(app.renderer.view.width/4+i%3*app.renderer.view.width/5,
                app.renderer.view.height/4*(2*Math.floor(i/3)+1));
            level.buttonMode = true;
            level.interactive = true;
            level.on('click', function(){
                window.location.href = this.text+".html";
            });
            app.stage.addChild(normalLevel, level);
            level.visible = false;
            switch(i){
                case 0:
                    if (visibility>=1) {
                        level.visible = true;
                        normalLevel.interactive = true;
                        normalLevel.buttonMode = true;
                        normalLevel.label = level.text;
                        normalLevel.on("click", function(){
                            window.location.href = this.label+".html";
                        })
                    }
                    break;
                case 1:
                    if (visibility>=2) {
                        level.visible = true;
                        normalLevel.interactive = true;
                        normalLevel.buttonMode = true;
                        normalLevel.label = level.text;
                        normalLevel.on("click", function(){
                            window.location.href = this.label+".html";
                        })
                    }
                    break;
                case 2:
                    if (visibility>=3) {
                        level.visible = true;
                        normalLevel.interactive = true;
                        normalLevel.buttonMode = true;
                        normalLevel.label = level.text;
                        normalLevel.on("click", function(){
                            window.location.href = this.label+".html";
                        })
                    }
                    break;
                case 3:
                    if (visibility>=4) {
                        level.visible = true;
                        normalLevel.interactive = true;
                        normalLevel.buttonMode = true;
                        normalLevel.label = level.text;
                        normalLevel.on("click", function(){
                            window.location.href = this.label+".html";
                        })
                    }
                    break;
                case 4:
                    if (visibility>=5) {
                        level.visible = true;
                        normalLevel.interactive = true;
                        normalLevel.buttonMode = true;
                        normalLevel.label = level.text;
                        normalLevel.on("click", function(){
                            window.location.href = this.label+".html";
                        })
                    }
                    break;
                case 5:
                    if (visibility>=6) {
                        level.visible = true;
                        normalLevel.interactive = true;
                        normalLevel.buttonMode = true;
                        normalLevel.label = level.text;
                        normalLevel.on("click", function(){
                            window.location.href = this.label+".html";
                        })
                    }
                    break;
            }
        }
        //draw the last level
        let finalLevel = new
        PIXI.Sprite(PIXI.loader.resources["assets/images/final chocolate.png"].texture);
        finalLevel.anchor.set(0.5, 0.5);
        finalLevel.position.set(app.renderer.view.width/7*6,
            app.renderer.view.height/2);
        finalLevel.scale.set(0.25, 0.25);
        let level = new PIXI.Text('"Surprise"');
        level.style = {
            fontFamily: "Arial",
            fontSize: 45,
            fill: "white",
        };
        level.anchor.set(0.5, 0.5);
        level.position.set(app.renderer.view.width/7*6,
            app.renderer.view.height/2);
        level.buttonMode = true;
        level.interactive = true;
        level.on('click', function(){
            window.location.href="Surprise.html";
        });
        if (visibility>=7) {
            finalLevel.visible = true;
            level.visible = true;
        } else {
            finalLevel.visible = false;
            level.visible = false;
        }
        app.stage.addChild(finalLevel, level);

        //add back
        let backBtn = new PIXI.Text("BACK");
        backBtn.style = {
            fontFamily: "Arial",
            fontSize: 30,
            fill: "gray",
        }
        backBtn.position.set(app.renderer.view.width/10, app.renderer.view.height/5*4);
        backBtn.buttonMode = true;
        backBtn.interactive = true;
        backBtn.on('click', goBack);
        function goBack() {
            window.location.href="index.html";
        }
        app.stage.addChild(backBtn);
    }
</script>
</body>
</html>